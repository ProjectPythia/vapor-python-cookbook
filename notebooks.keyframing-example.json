{"version":2,"kind":"Notebook","sha256":"045a1599fc7b0d28da87b33fa3b0a7882e32d93c1c4370f118ccaf04919e3935","slug":"notebooks.keyframing-example","location":"/notebooks/keyframing_example.ipynb","dependencies":[],"frontmatter":{"title":"Keyframing with Vapor","content_includes_title":false,"kernelspec":{"name":"python3","display_name":"vapor","language":"python"},"authors":[{"nameParsed":{"literal":"Project Pythia Community","given":"Project Pythia","family":"Community"},"name":"Project Pythia Community","url":"https://projectpythia.org/","id":"contributors-myst-generated-uid-0"}],"open_access":true,"license":{"content":{"id":"Apache-2.0","url":"https://opensource.org/licenses/Apache-2.0","name":"Apache License 2.0","free":true,"osi":true},"code":{"id":"CC-BY-4.0","url":"https://creativecommons.org/licenses/by/4.0/","name":"Creative Commons Attribution 4.0 International","free":true,"CC":true}},"github":"https://github.com/projectpythia/vapor-python-cookbook","copyright":"2024","affiliations":[{"id":"University at Albany (State University of New York)","name":"University at Albany (State University of New York)"},{"id":"UCAR/NCAR","name":"UCAR/NCAR"}],"numbering":{"title":{"offset":1}},"edit_url":"https://github.com/projectpythia/vapor-python-cookbook/blob/main/notebooks/keyframing_example.ipynb","exports":[{"format":"ipynb","filename":"keyframing_example.ipynb","url":"/vapor-python-cookbook/build/keyframing_example-5ea89a6da5a2a757a7b954e6bbb226c8.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"In this notebook, we will create an animation where our camera moves to view our visualization from different angles. We will achieve this using an animation technique called keyframing. This technique involves selecting several key scenes, known as keyframes, and then having the computer generate the intermediate frames between these keyframes. This process creates a smooth transition from one keyframe to the next, resulting in a fluid animation.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"PlSStgoTOM"}],"key":"keFcW2jy2D"}],"key":"HcTa131Rya"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Setup and data download","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"t1Y4lJm3Gh"}],"identifier":"setup-and-data-download","label":"Setup and data download","html_id":"setup-and-data-download","implicit":true,"key":"OGb1cE2vMR"}],"key":"s9lDtH3qfy"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from vapor import session, dataset, renderer\nfrom vapor.animation import Animation","key":"edl3BLU0mu"},{"type":"output","id":"Gs8wK98yLaPwvtcp0jg5S","data":[{"output_type":"error","traceback":"\u001b[31m---------------------------------------------------------------------------\u001b[39m\n\u001b[31mModuleNotFoundError\u001b[39m                       Traceback (most recent call last)\n\u001b[36mCell\u001b[39m\u001b[36m \u001b[39m\u001b[32mIn[1]\u001b[39m\u001b[32m, line 1\u001b[39m\n\u001b[32m----> \u001b[39m\u001b[32m1\u001b[39m \u001b[38;5;28;01mfrom\u001b[39;00m\u001b[38;5;250m \u001b[39m\u001b[34;01mvapor\u001b[39;00m\u001b[38;5;250m \u001b[39m\u001b[38;5;28;01mimport\u001b[39;00m session, dataset, renderer\n\u001b[32m      2\u001b[39m \u001b[38;5;28;01mfrom\u001b[39;00m\u001b[38;5;250m \u001b[39m\u001b[34;01mvapor\u001b[39;00m\u001b[34;01m.\u001b[39;00m\u001b[34;01manimation\u001b[39;00m\u001b[38;5;250m \u001b[39m\u001b[38;5;28;01mimport\u001b[39;00m Animation\n\n\u001b[31mModuleNotFoundError\u001b[39m: No module named 'vapor'","ename":"ModuleNotFoundError","evalue":"No module named 'vapor'"}],"key":"WMhttMDIDH"}],"key":"lcFlN3AWMf"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"The following cell will download the data from NCAR’s ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"bq1py9mBkK"},{"type":"link","url":"https://rda.ucar.edu/datasets/ds897.7/dataaccess/#","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Research Data Archives","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"hcLkPibejF"}],"urlSource":"https://rda.ucar.edu/datasets/ds897.7/dataaccess/#","key":"DjP6MICOWb"},{"type":"text","value":".","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"PAJIGM1MFl"}],"key":"i9B4p9WUJP"}],"key":"mTgDHC6vsc"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import os\nimport requests\nimport zipfile\nurl = 'https://data.rda.ucar.edu/ds897.7/Katrina.zip'\nextract_to = './data'\nzip_name = \"Katrina.zip\"\ndata_file = './data/wrfout_d02_2005-08-29_02.nc'\n\n# Check if the data file already exists\nif not os.path.exists(data_file):\n    # Download zip\n    with requests.get(url, stream=True) as r:\n        r.raise_for_status()\n        with open(zip_name, 'wb') as f:\n            for chunk in r.iter_content(chunk_size=8192):\n                f.write(chunk)\n    # Extract the file\n    with zipfile.ZipFile(zip_name, 'r') as zip_ref:\n        zip_ref.extractall(extract_to)\n\n    # Clean up the zip file\n    os.remove(zip_name)\n\n    print(f\"Data downloaded and extracted to {data_file}\")\nelse:\n    print(f\"Data file already exists at {data_file}, skipping download and extraction.\")\n","key":"ze24BVbT3r"},{"type":"output","id":"MBJ7EDWAn6b3Z4j_kP21S","data":[],"key":"CuNLQMvMwR"}],"key":"ESDZmTk3Xf"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Create keyframes","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"o5j5ryvqom"}],"identifier":"create-keyframes","label":"Create keyframes","html_id":"create-keyframes","implicit":true,"key":"nhaOKRAQ5j"}],"key":"LsMlEMyaU9"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"To begin creating our animation, we first create our keyframes. Each keyframe corresponds to a specific moment in our animation, defined by the camera’s position and orientation. We can create these keyframes using either Python or the Vapor application, and save them as session files. For the purpose of this notebook, we’ll input our camera information directly in Python, but in practice, it’s easier to fine-tune the camera settings within the application.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Ax7GSnm24i"}],"key":"qnafKOyGxI"}],"key":"PO9PfGCdmO"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"First we’ll create our static visualization. A detailed guide on how this is created can be found in the quickstart notebook","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"AbZY7HGp6J"}],"key":"FwYN7gFlm1"}],"key":"OY8HOmd6bz"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"ses = session.Session()\ndata = ses.OpenDataset(dataset.WRF, [\"data/wrfout_d02_2005-08-29_02.nc\"])\nland = data.NewRenderer(renderer.ImageRenderer) # Render land image\nland.GetTransform().SetTranslations([0,0,100])\nland.SetHeightVariableName(\"HGT\")\nwind = data.NewRenderer(renderer.TwoDDataRenderer) # Render U10\nwind.SetVariableName(\"U10\")\nclouds = data.NewRenderer(renderer.VolumeRenderer) # Render clouds\nclouds.SetVariableName(\"QCLOUD\")\nclouds_tf = clouds.GetTransferFunction(\"QCLOUD\")\nclouds_tf.LoadBuiltinColormap(\"Sequential/BlackWhite\")\nclouds_tf.SetColorRGBList([(r, g, b) for r, g, b, _ in \n                           list(reversed(clouds_tf.GetMatPlotLibColormap().colors))])\nclouds_tf.SetOpacityControlPoints([[0,0],[0.00001,0.01], [0.0001, 0.1], [0.0010,0.9]])","key":"o7h3BtxmIP"},{"type":"output","id":"4-y5pyyyoC8fplzYr6m4v","data":[],"key":"EQ4nml8Rlu"}],"key":"j2Gls6xRks"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Now, we’ll define the camera settings for each of our keyframes. These numbers are tricky to get right in Python, so it is recommended that they are selected within the application.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"QXU9YViHIf"}],"key":"wIRFFOBfGj"}],"key":"oBY0qAnbOn"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# The camera position of each keyframe\npositions = [\n    [-1190444.44426004, 1882360.85954653, 770176.40842364], # Keyframe 1\n    [-1172384.15238047, 2813172.26639064, 355291.41877028], # Keyframe 2\n    [-968784.32993129, 3056725.58106798, -34317.16158186], # ...\n    [-733144.08018801, 2929790.21696698, -32984.22588893],\n    [-691781.20449513, 2442083.68616993, -47289.68751812]\n]\n\n# The camera target for each keyframe\ntargets = [\n    [-420811.28125, 2737271.75, 5699.78515597], # Keyframe 1\n    [-420811.28125, 2737271.75, 15699.78515597], # ...\n    [-420811.28125, 2737271.75, 15699.78515597],\n    [-420811.28125, 2737271.75, 15699.78515597],\n    [-420811.28125, 2737271.75, 15699.78515597]\n]\n\n# The up vector for each keyframe\nups = [\n    [0.41853764, 0.35630071, 0.83538976],\n    [ 0.39861183, -0.08972356, 0.91272027],\n    [-0.08058301, 0.02890014, 0.99632884],\n    [-0.080583, 0.02890014, 0.99632884],\n    [-0.0964622, -0.0632074, 0.99332767]\n]","key":"FvPnd2L0oM"},{"type":"output","id":"jSpeh_0LTC4PQEIkwJp9n","data":[],"key":"qtOnlne3dH"}],"key":"Rx3iAXd9K5"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Now, we will save each of these camera settings to a session file to represent our keyframes.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"GWYp5drwUT"}],"key":"xImZTODdaS"}],"key":"JZzpsbgBSB"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"os.makedirs(\"keyframes\", exist_ok=True) # Make directory for keyframes if it doesn't exist\nfor i, position, target, up in zip(range(1, len(positions)+1), positions, targets, ups):\n    ses.GetCamera().LookAt(position, target, up)\n    ses.Save(f\"./keyframes/keyframe{i}.vs3\")","key":"FlXixI2qZx"},{"type":"output","id":"unN1wa2bdGI5AEHgHE7Ki","data":[],"key":"W9aWtUHOBa"}],"key":"zCGuCB8V96"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Generate Animation","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ROqPRX5ww2"}],"identifier":"generate-animation","label":"Generate Animation","html_id":"generate-animation","implicit":true,"key":"vj8nD2yXfe"}],"key":"nYmvjaPAp1"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Specify the paths to your session files (keyframes) and the number of interpolation steps between each keyframe.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"BEIF2fnKRr"}],"key":"gWg2ciWZb4"}],"key":"G7EyuK4XJH"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"sessions = [\n    \"keyframes/keyframe1.vs3\",\n    \"keyframes/keyframe2.vs3\",\n    \"keyframes/keyframe3.vs3\",\n    \"keyframes/keyframe4.vs3\",\n    \"keyframes/keyframe5.vs3\",\n]\nsteps = [40,30,30,30]","key":"Cr7ZckELJj"},{"type":"output","id":"VMmXM69rIQoS4uPo4NJh3","data":[],"key":"XuUmnxI2QK"}],"key":"WcuuPfhlWu"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Generate and Display Animation","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"VEOYd6FZqN"}],"identifier":"generate-and-display-animation","label":"Generate and Display Animation","html_id":"generate-and-display-animation","implicit":true,"key":"CmijP2N7lb"}],"key":"DN6rYqfZY0"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Now, we will create the animation using the defined keyframes and steps, then display it. Vapor’s ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Gt6Ke4sXnU"},{"type":"inlineCode","value":"utils.keyframing.animate_camera_keyframes","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"la2KoPdXUW"},{"type":"text","value":" utility function generates an animation using keyframing from a list of session paths and a corresponding list of integers that describe the number of frames between each keyframe. It creates and returns an animation that can be displayed.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"OQFYKKGO5I"}],"key":"tX0nBhJIdf"}],"key":"jnSImfKjnU"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from vapor.utils import keyframing\nanim = keyframing.animate_camera_keyframes(sessions, steps)\nanim.Show()","key":"kUt6wIJKRU"},{"type":"output","id":"waEfkVnVuYNR-4uLm7-N8","data":[],"key":"W1qFX8kSDO"}],"key":"fzI88qKu4p"}],"key":"PDrC5poH47"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Creating Animations","url":"/notebooks/animation-example","group":"Foundations of VAPOR Python"},"next":{"title":"Advecting Flow Paths","url":"/notebooks/flow-example","group":"Foundations of VAPOR Python"}}},"domain":"http://localhost:3000"}