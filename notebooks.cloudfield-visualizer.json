{"version":2,"kind":"Notebook","sha256":"af491bcf956e15808148ed35b0dfdbff5b5c5de6a9deae4dfdf3d6b75a465d16","slug":"notebooks.cloudfield-visualizer","location":"/notebooks/cloudfield_visualizer.ipynb","dependencies":[],"frontmatter":{"title":"Visualizing the cloud-capped boundary layer","content_includes_title":false,"kernelspec":{"name":"python3","display_name":"Python 3 (ipykernel)","language":"python"},"jupytext":{},"authors":[{"nameParsed":{"literal":"Project Pythia Community","given":"Project Pythia","family":"Community"},"name":"Project Pythia Community","url":"https://projectpythia.org/","id":"contributors-myst-generated-uid-0"}],"open_access":true,"license":{"content":{"id":"Apache-2.0","url":"https://opensource.org/licenses/Apache-2.0","name":"Apache License 2.0","free":true,"osi":true},"code":{"id":"CC-BY-4.0","url":"https://creativecommons.org/licenses/by/4.0/","name":"Creative Commons Attribution 4.0 International","free":true,"CC":true}},"github":"https://github.com/projectpythia/vapor-python-cookbook","copyright":"2024","affiliations":[{"id":"University at Albany (State University of New York)","name":"University at Albany (State University of New York)"},{"id":"UCAR/NCAR","name":"UCAR/NCAR"}],"numbering":{"title":{"offset":1}},"edit_url":"https://github.com/projectpythia/vapor-python-cookbook/blob/main/notebooks/cloudfield_visualizer.ipynb","exports":[{"format":"ipynb","filename":"cloudfield_visualizer.ipynb","url":"/vapor-python-cookbook/build/cloudfield_visualize-b095c07e32a6916eb6e627d59820bde4.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Data is from a large eddy simulation of trade cumulus clouds.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"GH9P2K8Dao"}],"key":"yEhTHBdaoA"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":5,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Single timestep at 12.5 m x, y, z grid spacing","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"fbew9fwdUx"}],"key":"fmEJhYIkNf"}],"key":"QL27mryJkl"},{"type":"listItem","spread":true,"position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Variable is QN -- cloud liquid water (g/kg)","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"pVXL65o3Db"}],"key":"vcJbH3WN2t"}],"key":"RpVMI9z3h1"}],"key":"AOduZeniwT"}],"key":"Hw8Vl3zo6A"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"link to data file","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"TLDT3R6ONE"}],"identifier":"link-to-data-file","label":"link to data file","html_id":"link-to-data-file","implicit":true,"key":"TiEegLs1Bm"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"The netcdf file:  bomex_qv_qn.nc -- 527 Mbytes","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"OgK9iaLfkK"}],"key":"fl2fsLTuA3"},{"type":"comment","value":" [https://drive.google.com/file/d/1E0IORCCpZUGaMClbv2m4YFfiM34kC1FY/view?usp=sharing](https://drive.google.com/file/d/1E0IORCCpZUGaMClbv2m4YFfiM34kC1FY/view?usp=sharing) ","key":"XTaUMfHgB1"}],"key":"dtFyTjNcpj"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import xarray as xr\nfrom pathlib import Path\nfrom vapor import session, renderer, dataset, camera","key":"NVuPKcRPjD"},{"type":"output","id":"OW7BFQDk7AFyj2DNqhp5a","data":[{"output_type":"error","traceback":"\u001b[31m---------------------------------------------------------------------------\u001b[39m\n\u001b[31mModuleNotFoundError\u001b[39m                       Traceback (most recent call last)\n\u001b[36mCell\u001b[39m\u001b[36m \u001b[39m\u001b[32mIn[1]\u001b[39m\u001b[32m, line 1\u001b[39m\n\u001b[32m----> \u001b[39m\u001b[32m1\u001b[39m \u001b[38;5;28;01mimport\u001b[39;00m\u001b[38;5;250m \u001b[39m\u001b[34;01mxarray\u001b[39;00m\u001b[38;5;250m \u001b[39m\u001b[38;5;28;01mas\u001b[39;00m\u001b[38;5;250m \u001b[39m\u001b[34;01mxr\u001b[39;00m\n\u001b[32m      2\u001b[39m \u001b[38;5;28;01mfrom\u001b[39;00m\u001b[38;5;250m \u001b[39m\u001b[34;01mpathlib\u001b[39;00m\u001b[38;5;250m \u001b[39m\u001b[38;5;28;01mimport\u001b[39;00m Path\n\u001b[32m      3\u001b[39m \u001b[38;5;28;01mfrom\u001b[39;00m\u001b[38;5;250m \u001b[39m\u001b[34;01mvapor\u001b[39;00m\u001b[38;5;250m \u001b[39m\u001b[38;5;28;01mimport\u001b[39;00m session, renderer, dataset, camera\n\n\u001b[31mModuleNotFoundError\u001b[39m: No module named 'xarray'","ename":"ModuleNotFoundError","evalue":"No module named 'xarray'"}],"key":"frUEBpngvO"}],"key":"WBtGk0KjE5"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"adjust path to point to file","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Uh4XoFfdiT"}],"identifier":"adjust-path-to-point-to-file","label":"adjust path to point to file","html_id":"adjust-path-to-point-to-file","implicit":true,"key":"Gs6DH8pzlN"}],"key":"X8ewkYAbyS"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"the_file = Path().resolve() / 'bomex_qv_qn.nc'\nprint(the_file)\nthe_file.exists()","key":"C4e2ch5VjI"},{"type":"output","id":"xLFMq_6_DE7Jo2QLZUYXF","data":[],"key":"FKygZcNZuW"}],"key":"y9vljTgMMD"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Inspect the xarray dataset","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"PoeSWV9t6w"}],"identifier":"inspect-the-xarray-dataset","label":"Inspect the xarray dataset","html_id":"inspect-the-xarray-dataset","implicit":true,"key":"uqnRrH8224"}],"key":"lHLnr8yGCB"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"bomex_data = xr.open_dataset(the_file)\nbomex_data","key":"QVJWFMp3VA"},{"type":"output","id":"F4Oj4GbefeoxPTp513B4r","data":[],"key":"DRYFzhiH9w"}],"key":"XqV93aWMdE"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"open as a Vapor dataset","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"k9M4RIZjSh"}],"identifier":"open-as-a-vapor-dataset","label":"open as a Vapor dataset","html_id":"open-as-a-vapor-dataset","implicit":true,"key":"Fz3bNfGzqI"}],"key":"sBwW9pOS38"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"ses = session.Session()\ndata = ses.OpenDataset(dataset.CF, [str(the_file)])\nses.Load('session.vs3')","key":"fP0xqakMOa"},{"type":"output","id":"78v8AO097bSzb0hoc-Oly","data":[],"key":"GozcJXw2aO"}],"key":"Y6DTiPKkvK"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"print(\"Time Coordinate Variable Name:\", data.GetTimeCoordVarName())\nprint(\"Coordinate Variable Names:\", data.GetCoordVarNames())\n\nprint(\"Dimensions:\")\nfor dim in data.GetDimensionNames():\n    print(f\"  {dim}:\", data.GetDimensionLength(dim, 0))\n\nprint(\"Data Variables:\")\nfor var in data.GetDataVarNames():\n    print(f\"  {var}\")\n    print(f\"    Time Varying:\", bool(data.IsTimeVarying(var)))\n    print(f\"    Dimensionality:\", data.GetVarGeometryDim(var))\n    print(f\"    Coordinates:\", data.GetVarCoordVars(var, True))\n    print(\"     Data Range:\", data.GetDataRange(var))","key":"ix5EntMrcC"},{"type":"output","id":"Ad9gZqdbpjjOXgVOL-6cn","data":[],"key":"ko9dYkOmaG"}],"key":"abnCXORumW"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Show gridcells","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"DbWxnT5DBz"}],"identifier":"show-gridcells","label":"Show gridcells","html_id":"show-gridcells","implicit":true,"key":"BVj7WO7pGi"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":3,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Red: watervapor","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"IAwk4AXXBM"}],"key":"NwZumOV2lG"},{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Grey: cloud liquid water","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"LDFWtSVbRO"}],"key":"ZewvtoLhHY"}],"key":"h2BjrgAsE7"},{"type":"paragraph","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"Top view of cloud field, with condensation threshold set to 0.01 g/kg","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"ZdhfEXKVno"}],"key":"KtDMw1RzLL"}],"key":"UkKduP3Yz9"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"ren = data.NewRenderer(renderer.VolumeIsoRenderer)\nren.SetVariableName(data.GetDataVarNames(3)[0]) # Set to first 3D data variable\nren.SetIsoValues([0.01])\n\nses.GetCamera().ViewAll()\nses.Show()","key":"k9rfWQGXz3"},{"type":"output","id":"LFAk_U2gflRD6ccfSGiQF","data":[],"key":"vi1f1EGf4n"}],"key":"JgUsbNxbEj"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Create visualizer widget","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"lXdAibAtCd"}],"identifier":"create-visualizer-widget","label":"Create visualizer widget","html_id":"create-visualizer-widget","implicit":true,"key":"e2dQKRonkH"}],"key":"z3krdgP01w"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from jupyter_vapor_widget import *\n\nviz = VaporVisualizerWidget(ses)\nviz","key":"VBtXEiUs27"},{"type":"output","id":"xp3LfIY2lGWlhTaHwZJxI","data":[],"key":"HkNh7fYCmh"}],"key":"wo1Uuhay1w"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Add a slider bar","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"S9cV22sHFP"}],"identifier":"add-a-slider-bar","label":"Add a slider bar","html_id":"add-a-slider-bar","implicit":true,"key":"djHY397kSc"}],"key":"GWWo22tFRs"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"tf = ren.GetPrimaryTransferFunction()\ndataRange = tf.GetMinMaxMapValue()\n\ndef sliderChanged(change):\n    ren.SetIsoValues([change.new])\n    viz.Render(fast=True)\n\nslider = widgets.FloatSlider(value=ren.GetIsoValues()[0], min=dataRange[0], max=dataRange[1], step=(dataRange[1]-dataRange[0])/100)\nslider.observe(sliderChanged, names='value')\n\nwidgets.VBox([\n    viz,\n    widgets.HBox([widgets.Label(\"Iso value:\"), slider])\n])","key":"z5nP91vBlZ"},{"type":"output","id":"H8qK8l1l0Pqp2acqZO0Gr","data":[],"key":"zhFRsGBNb2"}],"key":"nZU4lhGuep"}],"key":"pEF8LhVQN5"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Generic Workflow","url":"/notebooks/workflow-example","group":"Example workflows"}}},"domain":"http://localhost:3000"}