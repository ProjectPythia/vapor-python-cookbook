{"version":2,"kind":"Notebook","sha256":"af491bcf956e15808148ed35b0dfdbff5b5c5de6a9deae4dfdf3d6b75a465d16","slug":"notebooks.cloudfield-visualizer","location":"/notebooks/cloudfield_visualizer.ipynb","dependencies":[],"frontmatter":{"title":"Visualizing the cloud-capped boundary layer","content_includes_title":false,"kernelspec":{"name":"python3","display_name":"Python 3 (ipykernel)","language":"python"},"jupytext":{},"authors":[{"nameParsed":{"literal":"Project Pythia Community","given":"Project Pythia","family":"Community"},"name":"Project Pythia Community","url":"https://projectpythia.org/","id":"contributors-myst-generated-uid-0"}],"open_access":true,"license":{"content":{"id":"Apache-2.0","url":"https://opensource.org/licenses/Apache-2.0","name":"Apache License 2.0","free":true,"osi":true},"code":{"id":"CC-BY-4.0","url":"https://creativecommons.org/licenses/by/4.0/","name":"Creative Commons Attribution 4.0 International","free":true,"CC":true}},"github":"https://github.com/projectpythia/vapor-python-cookbook","copyright":"2024","affiliations":[{"id":"University at Albany (State University of New York)","name":"University at Albany (State University of New York)"},{"id":"UCAR/NCAR","name":"UCAR/NCAR"}],"numbering":{"title":{"offset":1}},"edit_url":"https://github.com/projectpythia/vapor-python-cookbook/blob/main/notebooks/cloudfield_visualizer.ipynb","exports":[{"format":"ipynb","filename":"cloudfield_visualizer.ipynb","url":"/vapor-python-cookbook/build/cloudfield_visualize-311d9dbb2f26de4563b1739ccb198d1d.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Data is from a large eddy simulation of trade cumulus clouds.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"VUFD58m9kY"}],"key":"LwwfY0M5mk"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":5,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Single timestep at 12.5 m x, y, z grid spacing","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"K5UrqJtnq8"}],"key":"FlgdXPkfVs"}],"key":"l8cE7TkTZH"},{"type":"listItem","spread":true,"position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Variable is QN -- cloud liquid water (g/kg)","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"tKVwuGgDqk"}],"key":"QOXrB4VF5f"}],"key":"y8Ur92K50f"}],"key":"SDfFzbjIJ9"}],"key":"ZaBtCBvsdn"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"link to data file","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Ay194cKCqH"}],"identifier":"link-to-data-file","label":"link to data file","html_id":"link-to-data-file","implicit":true,"key":"OmaOzYqRYH"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"The netcdf file:  bomex_qv_qn.nc -- 527 Mbytes","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"yZnrGl5M7N"}],"key":"Ba20hwS8r0"},{"type":"comment","value":" [https://drive.google.com/file/d/1E0IORCCpZUGaMClbv2m4YFfiM34kC1FY/view?usp=sharing](https://drive.google.com/file/d/1E0IORCCpZUGaMClbv2m4YFfiM34kC1FY/view?usp=sharing) ","key":"dYjJwwjwgL"}],"key":"Rwnjgrj3lm"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import xarray as xr\nfrom pathlib import Path\nfrom vapor import session, renderer, dataset, camera","key":"VahpGYojeh"},{"type":"output","id":"W0c7LEt58hEUZ6l6RVT_Q","data":[{"output_type":"error","traceback":"\u001b[31m---------------------------------------------------------------------------\u001b[39m\n\u001b[31mModuleNotFoundError\u001b[39m                       Traceback (most recent call last)\n\u001b[36mCell\u001b[39m\u001b[36m \u001b[39m\u001b[32mIn[1]\u001b[39m\u001b[32m, line 1\u001b[39m\n\u001b[32m----> \u001b[39m\u001b[32m1\u001b[39m \u001b[38;5;28;01mimport\u001b[39;00m\u001b[38;5;250m \u001b[39m\u001b[34;01mxarray\u001b[39;00m\u001b[38;5;250m \u001b[39m\u001b[38;5;28;01mas\u001b[39;00m\u001b[38;5;250m \u001b[39m\u001b[34;01mxr\u001b[39;00m\n\u001b[32m      2\u001b[39m \u001b[38;5;28;01mfrom\u001b[39;00m\u001b[38;5;250m \u001b[39m\u001b[34;01mpathlib\u001b[39;00m\u001b[38;5;250m \u001b[39m\u001b[38;5;28;01mimport\u001b[39;00m Path\n\u001b[32m      3\u001b[39m \u001b[38;5;28;01mfrom\u001b[39;00m\u001b[38;5;250m \u001b[39m\u001b[34;01mvapor\u001b[39;00m\u001b[38;5;250m \u001b[39m\u001b[38;5;28;01mimport\u001b[39;00m session, renderer, dataset, camera\n\n\u001b[31mModuleNotFoundError\u001b[39m: No module named 'xarray'","ename":"ModuleNotFoundError","evalue":"No module named 'xarray'"}],"key":"z8an7wcLIF"}],"key":"fWakXu4Ghh"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"adjust path to point to file","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"NUTruC6tEP"}],"identifier":"adjust-path-to-point-to-file","label":"adjust path to point to file","html_id":"adjust-path-to-point-to-file","implicit":true,"key":"De99B5svhQ"}],"key":"DkjKHjAv6w"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"the_file = Path().resolve() / 'bomex_qv_qn.nc'\nprint(the_file)\nthe_file.exists()","key":"G03fAQAmiz"},{"type":"output","id":"_dJ97xDaMhwNtnamZJ7tr","data":[],"key":"FN8su2NrBN"}],"key":"HH8SnSPwil"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Inspect the xarray dataset","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"OWFXijltmK"}],"identifier":"inspect-the-xarray-dataset","label":"Inspect the xarray dataset","html_id":"inspect-the-xarray-dataset","implicit":true,"key":"aaGK28ppp4"}],"key":"BgSlA8ymbf"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"bomex_data = xr.open_dataset(the_file)\nbomex_data","key":"PWfZRQ6HWS"},{"type":"output","id":"gRSisC-nMFVgSZFx5FvgD","data":[],"key":"FiVVUlGR4L"}],"key":"JkPu3bnEqR"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"open as a Vapor dataset","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"pZ7A0GiOiq"}],"identifier":"open-as-a-vapor-dataset","label":"open as a Vapor dataset","html_id":"open-as-a-vapor-dataset","implicit":true,"key":"pKgH1iijcJ"}],"key":"Cla0a8ywAB"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"ses = session.Session()\ndata = ses.OpenDataset(dataset.CF, [str(the_file)])\nses.Load('session.vs3')","key":"tpsLk2A5ls"},{"type":"output","id":"440UR1sgjMcgq259-PAER","data":[],"key":"f2iV2CYgCO"}],"key":"TE0H1nwOXf"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"print(\"Time Coordinate Variable Name:\", data.GetTimeCoordVarName())\nprint(\"Coordinate Variable Names:\", data.GetCoordVarNames())\n\nprint(\"Dimensions:\")\nfor dim in data.GetDimensionNames():\n    print(f\"  {dim}:\", data.GetDimensionLength(dim, 0))\n\nprint(\"Data Variables:\")\nfor var in data.GetDataVarNames():\n    print(f\"  {var}\")\n    print(f\"    Time Varying:\", bool(data.IsTimeVarying(var)))\n    print(f\"    Dimensionality:\", data.GetVarGeometryDim(var))\n    print(f\"    Coordinates:\", data.GetVarCoordVars(var, True))\n    print(\"     Data Range:\", data.GetDataRange(var))","key":"v0iIEo1E8c"},{"type":"output","id":"tdEx9rld4l6Vhgk-vXWML","data":[],"key":"TWwbMvwsJH"}],"key":"wvUvLxA2Li"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Show gridcells","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"m6hbWoWqEh"}],"identifier":"show-gridcells","label":"Show gridcells","html_id":"show-gridcells","implicit":true,"key":"Ujdb58fwQS"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":3,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Red: watervapor","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"JzCFbYHGcU"}],"key":"EZBDsM4OJz"},{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Grey: cloud liquid water","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"Otc8mU98zf"}],"key":"TZzrXHF9Ql"}],"key":"nvX9KSf2My"},{"type":"paragraph","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"Top view of cloud field, with condensation threshold set to 0.01 g/kg","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"tzyIDnlUNe"}],"key":"BKjvFeuHuU"}],"key":"mcAnhgg9GP"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"ren = data.NewRenderer(renderer.VolumeIsoRenderer)\nren.SetVariableName(data.GetDataVarNames(3)[0]) # Set to first 3D data variable\nren.SetIsoValues([0.01])\n\nses.GetCamera().ViewAll()\nses.Show()","key":"TjnRkm9SfZ"},{"type":"output","id":"Qg265Mx2riDgHGatIGtd6","data":[],"key":"pim6FEMODk"}],"key":"adcxqEq2Rf"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Create visualizer widget","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"qqSxPJmjRD"}],"identifier":"create-visualizer-widget","label":"Create visualizer widget","html_id":"create-visualizer-widget","implicit":true,"key":"IPij1OP0LX"}],"key":"VPnA0r8vYV"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from jupyter_vapor_widget import *\n\nviz = VaporVisualizerWidget(ses)\nviz","key":"b8I7tAmTj0"},{"type":"output","id":"plGjJI9kS4hjDYowyI8Vg","data":[],"key":"BrEWN9z9YU"}],"key":"QfcnrGUrkM"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Add a slider bar","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"x4donzQjuO"}],"identifier":"add-a-slider-bar","label":"Add a slider bar","html_id":"add-a-slider-bar","implicit":true,"key":"mieFBipC01"}],"key":"xSj727yQYv"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"tf = ren.GetPrimaryTransferFunction()\ndataRange = tf.GetMinMaxMapValue()\n\ndef sliderChanged(change):\n    ren.SetIsoValues([change.new])\n    viz.Render(fast=True)\n\nslider = widgets.FloatSlider(value=ren.GetIsoValues()[0], min=dataRange[0], max=dataRange[1], step=(dataRange[1]-dataRange[0])/100)\nslider.observe(sliderChanged, names='value')\n\nwidgets.VBox([\n    viz,\n    widgets.HBox([widgets.Label(\"Iso value:\"), slider])\n])","key":"utjfVxd9If"},{"type":"output","id":"RLCIdORLkM9o5co1YWzFz","data":[],"key":"yJ7CdAU9Gi"}],"key":"XRUb1YU6YD"}],"key":"XI8VCaNqSN"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Generic Workflow","url":"/notebooks/workflow-example","group":"Example workflows"}}},"domain":"http://localhost:3000"}