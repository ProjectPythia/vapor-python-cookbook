{"version":2,"kind":"Notebook","sha256":"af491bcf956e15808148ed35b0dfdbff5b5c5de6a9deae4dfdf3d6b75a465d16","slug":"notebooks.cloudfield-visualizer","location":"/notebooks/cloudfield_visualizer.ipynb","dependencies":[],"frontmatter":{"title":"Visualizing the cloud-capped boundary layer","content_includes_title":false,"kernelspec":{"name":"python3","display_name":"Python 3 (ipykernel)","language":"python"},"jupytext":{},"authors":[{"nameParsed":{"literal":"Project Pythia Community","given":"Project Pythia","family":"Community"},"name":"Project Pythia Community","url":"https://projectpythia.org/","id":"contributors-myst-generated-uid-0"}],"open_access":true,"license":{"content":{"id":"Apache-2.0","url":"https://opensource.org/licenses/Apache-2.0","name":"Apache License 2.0","free":true,"osi":true},"code":{"id":"CC-BY-4.0","url":"https://creativecommons.org/licenses/by/4.0/","name":"Creative Commons Attribution 4.0 International","free":true,"CC":true}},"github":"https://github.com/projectpythia/vapor-python-cookbook","copyright":"2024","affiliations":[{"id":"University at Albany (State University of New York)","name":"University at Albany (State University of New York)"},{"id":"UCAR/NCAR","name":"UCAR/NCAR"}],"numbering":{"title":{"offset":1}},"edit_url":"https://github.com/projectpythia/vapor-python-cookbook/blob/main/notebooks/cloudfield_visualizer.ipynb","exports":[{"format":"ipynb","filename":"cloudfield_visualizer.ipynb","url":"/vapor-python-cookbook/build/cloudfield_visualize-cc0fe81bfbf7e5627dfd157315cd52bb.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Data is from a large eddy simulation of trade cumulus clouds.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"uFydBRxAa6"}],"key":"sPxLlm3Uwe"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":5,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Single timestep at 12.5 m x, y, z grid spacing","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"uWCjKn0MD5"}],"key":"RxP9OW1d9q"}],"key":"I3btVbPwGS"},{"type":"listItem","spread":true,"position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Variable is QN -- cloud liquid water (g/kg)","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"FKq4gYwSze"}],"key":"AGQmiZO96F"}],"key":"oW1fckQGZ6"}],"key":"Y68bAaOeWE"}],"key":"FtWjQU3dNR"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"link to data file","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"IOJDeektlE"}],"identifier":"link-to-data-file","label":"link to data file","html_id":"link-to-data-file","implicit":true,"key":"bq9CFs5h8V"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"The netcdf file:  bomex_qv_qn.nc -- 527 Mbytes","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"lxISJfUbAF"}],"key":"lToVgcFbWi"},{"type":"comment","value":" [https://drive.google.com/file/d/1E0IORCCpZUGaMClbv2m4YFfiM34kC1FY/view?usp=sharing](https://drive.google.com/file/d/1E0IORCCpZUGaMClbv2m4YFfiM34kC1FY/view?usp=sharing) ","key":"zAo2KqYdJX"}],"key":"BGMQ9lnwt1"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import xarray as xr\nfrom pathlib import Path\nfrom vapor import session, renderer, dataset, camera","key":"SmVIrX8u6W"},{"type":"output","id":"Krph-MN4afoaE7jBobTrk","data":[{"output_type":"error","traceback":"\u001b[31m---------------------------------------------------------------------------\u001b[39m\n\u001b[31mModuleNotFoundError\u001b[39m                       Traceback (most recent call last)\n\u001b[36mCell\u001b[39m\u001b[36m \u001b[39m\u001b[32mIn[1]\u001b[39m\u001b[32m, line 1\u001b[39m\n\u001b[32m----> \u001b[39m\u001b[32m1\u001b[39m \u001b[38;5;28;01mimport\u001b[39;00m\u001b[38;5;250m \u001b[39m\u001b[34;01mxarray\u001b[39;00m\u001b[38;5;250m \u001b[39m\u001b[38;5;28;01mas\u001b[39;00m\u001b[38;5;250m \u001b[39m\u001b[34;01mxr\u001b[39;00m\n\u001b[32m      2\u001b[39m \u001b[38;5;28;01mfrom\u001b[39;00m\u001b[38;5;250m \u001b[39m\u001b[34;01mpathlib\u001b[39;00m\u001b[38;5;250m \u001b[39m\u001b[38;5;28;01mimport\u001b[39;00m Path\n\u001b[32m      3\u001b[39m \u001b[38;5;28;01mfrom\u001b[39;00m\u001b[38;5;250m \u001b[39m\u001b[34;01mvapor\u001b[39;00m\u001b[38;5;250m \u001b[39m\u001b[38;5;28;01mimport\u001b[39;00m session, renderer, dataset, camera\n\n\u001b[31mModuleNotFoundError\u001b[39m: No module named 'xarray'","ename":"ModuleNotFoundError","evalue":"No module named 'xarray'"}],"key":"mH8zdFz3ex"}],"key":"xT5giPuWLY"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"adjust path to point to file","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"fGNYJNvDfk"}],"identifier":"adjust-path-to-point-to-file","label":"adjust path to point to file","html_id":"adjust-path-to-point-to-file","implicit":true,"key":"Bmc0NEkM51"}],"key":"LykXCMXS0i"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"the_file = Path().resolve() / 'bomex_qv_qn.nc'\nprint(the_file)\nthe_file.exists()","key":"VbqIKwOwjj"},{"type":"output","id":"VK6JS0RVKDec3poGA-95u","data":[],"key":"HJrL1aM0Uw"}],"key":"v3zC415HfI"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Inspect the xarray dataset","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"pyNCmormKJ"}],"identifier":"inspect-the-xarray-dataset","label":"Inspect the xarray dataset","html_id":"inspect-the-xarray-dataset","implicit":true,"key":"Y5uGXRCnIA"}],"key":"I0OtX7ZaMD"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"bomex_data = xr.open_dataset(the_file)\nbomex_data","key":"gqFR6m99ql"},{"type":"output","id":"WChcpPWymq7k04_3ASdqH","data":[],"key":"ctSYr0FNpX"}],"key":"sqXfrQdIXV"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"open as a Vapor dataset","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"TDfPY72aTA"}],"identifier":"open-as-a-vapor-dataset","label":"open as a Vapor dataset","html_id":"open-as-a-vapor-dataset","implicit":true,"key":"QyZmWrzLOG"}],"key":"JJmByih4MP"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"ses = session.Session()\ndata = ses.OpenDataset(dataset.CF, [str(the_file)])\nses.Load('session.vs3')","key":"Rcr7JBJ4nw"},{"type":"output","id":"8yYUlIB0cW4vunHiq9UW8","data":[],"key":"xHSkJUSf68"}],"key":"xlj8dseKEg"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"print(\"Time Coordinate Variable Name:\", data.GetTimeCoordVarName())\nprint(\"Coordinate Variable Names:\", data.GetCoordVarNames())\n\nprint(\"Dimensions:\")\nfor dim in data.GetDimensionNames():\n    print(f\"  {dim}:\", data.GetDimensionLength(dim, 0))\n\nprint(\"Data Variables:\")\nfor var in data.GetDataVarNames():\n    print(f\"  {var}\")\n    print(f\"    Time Varying:\", bool(data.IsTimeVarying(var)))\n    print(f\"    Dimensionality:\", data.GetVarGeometryDim(var))\n    print(f\"    Coordinates:\", data.GetVarCoordVars(var, True))\n    print(\"     Data Range:\", data.GetDataRange(var))","key":"SOOfWjBOuc"},{"type":"output","id":"oTYWSVslWekujCYzZAq87","data":[],"key":"JZlJHOr2fN"}],"key":"MUTF6pytH6"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Show gridcells","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"II72kgVObL"}],"identifier":"show-gridcells","label":"Show gridcells","html_id":"show-gridcells","implicit":true,"key":"KvzYKVHLLA"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":3,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Red: watervapor","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"cn5T1n3XQO"}],"key":"OWXrwQ1JXb"},{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Grey: cloud liquid water","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"lf2I3uFRC3"}],"key":"EmGI0DDJW0"}],"key":"ch2WAPOylg"},{"type":"paragraph","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"Top view of cloud field, with condensation threshold set to 0.01 g/kg","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"UXedpUq8Hs"}],"key":"aJVbOIASKD"}],"key":"cufoRtwkmi"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"ren = data.NewRenderer(renderer.VolumeIsoRenderer)\nren.SetVariableName(data.GetDataVarNames(3)[0]) # Set to first 3D data variable\nren.SetIsoValues([0.01])\n\nses.GetCamera().ViewAll()\nses.Show()","key":"TE0hsq2rrz"},{"type":"output","id":"9fwEjKiEgGweKG8XAxp0G","data":[],"key":"fGugiaHZwp"}],"key":"NnJP8tilFP"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Create visualizer widget","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"eZ3F3uydou"}],"identifier":"create-visualizer-widget","label":"Create visualizer widget","html_id":"create-visualizer-widget","implicit":true,"key":"qNJhoeCRof"}],"key":"c78fnl9lJz"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from jupyter_vapor_widget import *\n\nviz = VaporVisualizerWidget(ses)\nviz","key":"UlyvFh4Msd"},{"type":"output","id":"wjha6YEyWN3eTwVEil1Qh","data":[],"key":"P5ocAGuTPl"}],"key":"oTGZSdgcjK"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Add a slider bar","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"kCUvJwTrNn"}],"identifier":"add-a-slider-bar","label":"Add a slider bar","html_id":"add-a-slider-bar","implicit":true,"key":"Ck5VCdQh1Z"}],"key":"DYsqW1avzC"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"tf = ren.GetPrimaryTransferFunction()\ndataRange = tf.GetMinMaxMapValue()\n\ndef sliderChanged(change):\n    ren.SetIsoValues([change.new])\n    viz.Render(fast=True)\n\nslider = widgets.FloatSlider(value=ren.GetIsoValues()[0], min=dataRange[0], max=dataRange[1], step=(dataRange[1]-dataRange[0])/100)\nslider.observe(sliderChanged, names='value')\n\nwidgets.VBox([\n    viz,\n    widgets.HBox([widgets.Label(\"Iso value:\"), slider])\n])","key":"lTyx6cO0B8"},{"type":"output","id":"oVM0_P3q7cpOPkeHLJl67","data":[],"key":"Pn1Zy3Dpp0"}],"key":"UK6ItbqJqe"}],"key":"Vi3y2vYTVg"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Generic Workflow","url":"/notebooks/workflow-example","group":"Example workflows"}}},"domain":"http://localhost:3000"}