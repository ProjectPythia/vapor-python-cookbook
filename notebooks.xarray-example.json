{"version":2,"kind":"Notebook","sha256":"418533bfe73c142d904df219923e2ee8a5b024644430537da998d74efc8fa66b","slug":"notebooks.xarray-example","location":"/notebooks/xarray_example.ipynb","dependencies":[],"frontmatter":{"title":"Rendering XArray data with Vapor","content_includes_title":false,"kernelspec":{"name":"python3","display_name":"vapor","language":"python"},"jupytext":{},"authors":[{"nameParsed":{"literal":"Project Pythia Community","given":"Project Pythia","family":"Community"},"name":"Project Pythia Community","url":"https://projectpythia.org/","id":"contributors-myst-generated-uid-0"}],"open_access":true,"license":{"content":{"id":"Apache-2.0","url":"https://opensource.org/licenses/Apache-2.0","name":"Apache License 2.0","free":true,"osi":true},"code":{"id":"CC-BY-4.0","url":"https://creativecommons.org/licenses/by/4.0/","name":"Creative Commons Attribution 4.0 International","free":true,"CC":true}},"github":"https://github.com/projectpythia/vapor-python-cookbook","copyright":"2024","affiliations":[{"id":"University at Albany (State University of New York)","name":"University at Albany (State University of New York)"},{"id":"UCAR/NCAR","name":"UCAR/NCAR"}],"numbering":{"title":{"offset":1}},"edit_url":"https://github.com/projectpythia/vapor-python-cookbook/blob/main/notebooks/xarray_example.ipynb","exports":[{"format":"ipynb","filename":"xarray_example.ipynb","url":"/vapor-python-cookbook/build/xarray_example-25f967dd79fc1558c5a93ac2bade1fbf.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","data":{"lines_to_next_cell":0,"region_name":"md"},"children":[{"type":"paragraph","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"While it is recommended to import data into Vapor using ","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"srM7LbOdFN"},{"type":"inlineCode","value":"session.LoadDataset()","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"qFKgyjNRRQ"},{"type":"text","value":", Vapor also supports importing data from XArray datasets.","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"KySQGOtTCz"}],"key":"HoWzZc8yaa"}],"key":"GCeyoNSE9r"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"The following cell will download sample data from NCAR’s ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Dl71e30cNO"},{"type":"link","url":"https://rda.ucar.edu/datasets/ds897.7/dataaccess/#","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Research Data Archives","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"rncq0wggfH"}],"urlSource":"https://rda.ucar.edu/datasets/ds897.7/dataaccess/#","key":"X7GrgmOoo4"},{"type":"text","value":".","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"vWCCQZAavP"}],"key":"cWLbRh76tm"}],"key":"x5snyPppyM"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import os\nimport requests\nimport zipfile\nurl = 'https://data.rda.ucar.edu/ds897.7/Katrina.zip'\nextract_to = './data'\nzip_name = \"Katrina.zip\"\ndata_file = './data/wrfout_d02_2005-08-29_02.nc'\n\n# Check if the data file already exists\nif not os.path.exists(data_file):\n    # Download zip\n    with requests.get(url, stream=True) as r:\n        r.raise_for_status()\n        with open(zip_name, 'wb') as f:\n            for chunk in r.iter_content(chunk_size=8192):\n                f.write(chunk)\n    # Extract the file\n    with zipfile.ZipFile(zip_name, 'r') as zip_ref:\n        zip_ref.extractall(extract_to)\n\n    # Clean up the zip file\n    os.remove(zip_name)\n\n    print(f\"Data downloaded and extracted to {data_file}\")\nelse:\n    print(f\"Data file already exists at {data_file}, skipping download and extraction.\")\n","key":"HeXJmkRhA3"},{"type":"output","id":"PP1p3hXE6Gpo-q8Mdqd1V","data":[{"output_type":"stream","name":"stdout","text":"Data downloaded and extracted to ./data/wrfout_d02_2005-08-29_02.nc\n"}],"key":"vEYgeRY95c"}],"key":"Qg3rXwOOWU"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"In order to pass XArray data to Vapor, create a data set within your vapor session using ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"INZ0lmUHUb"},{"type":"inlineCode","value":"Session.CreatePythonDataset()","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"MWuhy07Yp2"},{"type":"text","value":".","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"EsQM2kfKqe"}],"key":"HNEbq099b8"}],"key":"FKR5lGFgo9"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2023-06-22T17:22:30.438458Z","iopub.status.busy":"2023-06-22T17:22:30.438155Z","iopub.status.idle":"2023-06-22T17:22:35.224291Z","shell.execute_reply":"2023-06-22T17:22:35.223575Z"},"lines_to_next_cell":1},"children":[{"type":"code","lang":"python","executable":true,"value":"from vapor import session, renderer, dataset, camera\nimport xarray as xr\n\nses = session.Session()\ndata = ses.CreatePythonDataset()","key":"cmz4MP9aAW"},{"type":"output","id":"AqCdU9PHz4H7pEJoClIfi","data":[{"output_type":"error","traceback":"\u001b[31m---------------------------------------------------------------------------\u001b[39m\n\u001b[31mModuleNotFoundError\u001b[39m                       Traceback (most recent call last)\n\u001b[36mCell\u001b[39m\u001b[36m \u001b[39m\u001b[32mIn[2]\u001b[39m\u001b[32m, line 1\u001b[39m\n\u001b[32m----> \u001b[39m\u001b[32m1\u001b[39m \u001b[38;5;28;01mfrom\u001b[39;00m\u001b[38;5;250m \u001b[39m\u001b[34;01mvapor\u001b[39;00m\u001b[38;5;250m \u001b[39m\u001b[38;5;28;01mimport\u001b[39;00m session, renderer, dataset, camera\n\u001b[32m      2\u001b[39m \u001b[38;5;28;01mimport\u001b[39;00m\u001b[38;5;250m \u001b[39m\u001b[34;01mxarray\u001b[39;00m\u001b[38;5;250m \u001b[39m\u001b[38;5;28;01mas\u001b[39;00m\u001b[38;5;250m \u001b[39m\u001b[34;01mxr\u001b[39;00m\n\u001b[32m      4\u001b[39m ses = session.Session()\n\n\u001b[31mModuleNotFoundError\u001b[39m: No module named 'vapor'","ename":"ModuleNotFoundError","evalue":"No module named 'vapor'"}],"key":"M0k3EX2gl8"}],"key":"EKOuMn5gsD"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"First we will load the dataset with XArray","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"eq6fvpTsBK"}],"key":"QmT5uyIFpL"}],"key":"pahEiP1KEI"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"ds = xr.open_dataset(\"data/wrfout_d02_2005-08-29_02.nc\")\nds","key":"mdFwOtE9Lj"},{"type":"output","id":"CkWWSaKrpzUv6Y2tV9NVG","data":[],"key":"Sz9ExmpEzJ"}],"key":"KrKQLCjlY9"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"We can add variables from our XArray dataset to our Vapor dataset using ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Z9APh7XFY6"},{"type":"inlineCode","value":"dataset.AddXarrayDataset()","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"e5HZ1BxZfe"},{"type":"text","value":". We should be careful though -- once the data is loaded with XArray, Vapor cannot determine if a dimension is spatial or temporal. Because of this, we should make sure the data array we pass contains only spatial dimensions.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"sU3uRWxAwm"}],"key":"l0aJoY0ngm"}],"key":"Hn6uq1lRMx"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"U10 = ds[\"U10\"]\nU10","key":"Fpenl0Yttm"},{"type":"output","id":"bUTmHOOgzLHwurHLXPB7Q","data":[],"key":"rsnlKOUClZ"}],"key":"QpRXLqA7fF"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"In this case, U10 should be a two dimensional variable (longitude and latitude). But notice that in the DataArray we just created we still have a time dimension. Because of this, Vapor will incorrectly treat it as a 3 dimensional variable. Before passing the DataArray to Vapor, we should remove the temporal dimension.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"dkJmBpas3K"}],"key":"vVTLqA5vew"}],"key":"kEKZBHVGuu"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"U10 = ds[\"U10\"].squeeze(\"Time\")\nU10","key":"QfJlkvsmgZ"},{"type":"output","id":"Gth85Dd6hdz4JqLw-oNPh","data":[],"key":"KPXpU7gNPb"}],"key":"OWZqj0aPst"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Now, we can add this variable to our Vapor dataset with ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"QjOnTj7gBX"},{"type":"inlineCode","value":"dataset.AddXArrayData()","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"huI5VUGrl0"},{"type":"text","value":". The first parameter will be the variable name that we want to appear in our Vapor dataset, while the second parameter is the XArray DataArray.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"KIhULrfTjj"}],"key":"oH3VGj3CtM"}],"key":"qmVVPl9xl7"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"data.AddXArrayData(\"U10\", U10)","key":"jPfsqqVfnN"},{"type":"output","id":"Ld51AzKkasgiU9kw32TqR","data":[],"key":"hW7NcdcRRf"}],"key":"HusZGQ8QxN"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Now, we can render our data using any of Vapor’s renderers.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"C7yvJGynHb"}],"key":"XW2qi28ncm"}],"key":"zQZgOfe3WJ"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2023-06-22T17:22:35.985416Z","iopub.status.busy":"2023-06-22T17:22:35.985206Z","iopub.status.idle":"2023-06-22T17:22:36.111916Z","shell.execute_reply":"2023-06-22T17:22:36.111344Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Create a renderer for the data\nren = data.NewRenderer(renderer.WireFrameRenderer)\nren.SetVariableName(\"U10\")","key":"rUdaEQQgUW"},{"type":"output","id":"6aUPgv-VsUQWqoBIzKucb","data":[],"key":"UMdm6QWxIh"}],"key":"STkob1ADLD"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2023-06-22T17:22:36.114866Z","iopub.status.busy":"2023-06-22T17:22:36.114519Z","iopub.status.idle":"2023-06-22T17:22:36.239313Z","shell.execute_reply":"2023-06-22T17:22:36.238704Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Show the rendering\nses.GetCamera().ViewAll()\nses.Show()","key":"jNt3Oj6MNR"},{"type":"output","id":"4SqlzgOWY-a1majIArajO","data":[],"key":"B8TkASdFqf"}],"key":"ygcfdIrQPN"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2023-06-22T17:22:36.242200Z","iopub.status.busy":"2023-06-22T17:22:36.241950Z","iopub.status.idle":"2023-06-22T17:22:36.258140Z","shell.execute_reply":"2023-06-22T17:22:36.257530Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"ses.DeleteRenderer(ren)","key":"YOxneNbcim"},{"type":"output","id":"26bDnJGw87aDh-mcn-Z-S","data":[],"key":"tlCxiagJIr"}],"key":"buFhmCkub8"},{"type":"block","kind":"notebook-content","data":{"lines_to_next_cell":0,"region_name":"md"},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"The same process can be used to render a 3D variable","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"eefkeeuBAG"}],"key":"AIOEJxM6U4"}],"key":"AlPSaIfH8h"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2023-06-22T17:22:36.261106Z","iopub.status.busy":"2023-06-22T17:22:36.260850Z","iopub.status.idle":"2023-06-22T17:22:36.267776Z","shell.execute_reply":"2023-06-22T17:22:36.267211Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"data.AddXArrayData(\"U\", ds[\"U\"].squeeze(\"Time\"))","key":"ZpS7JJkTYc"},{"type":"output","id":"wwABLab5Pj3nwwOjXved4","data":[],"key":"ymj0xNIvf7"}],"key":"iZ9jkK6uFx"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"ren = data.NewRenderer(renderer.WireFrameRenderer)\nren.SetVariableName(\"U\")\nses.GetCamera().LookAt([ 138.64364963, -213.94716727,  293.46022828],\n                       [157., 154.,   0.],\n                       [0.04815987, 0.62133843, 0.78206086])","key":"W1wzqrBje3"},{"type":"output","id":"rn_dhjHfC7A0Bs6P4pTeH","data":[],"key":"zushdFBcx4"}],"key":"EU5EgroVzp"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"ses.Show()","key":"NnhLCXtlGF"},{"type":"output","id":"cFo9fmBe2TbYHPI6hh3D7","data":[],"key":"bzpZaLmJR8"}],"key":"mIu7mNVOLo"}],"key":"kHn6gGSRlA"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Rendering Numpy data with Vapor","url":"/notebooks/numpy-example","group":"Foundations of VAPOR Python"},"next":{"title":"Controlling the Camera","url":"/notebooks/camera-example","group":"Foundations of VAPOR Python"}}},"domain":"http://localhost:3000"}